from icecream import ic
synced_lyrics_tupel_array = [(1560, "Ey, ich schau' dich an und du siehst top aus"),
                (3950, 'Baby schau mich an und zieh dein Top aus'),
                (7760, "Mach's wie mit einem Lollipop"),
                (11820, 'Dann kauf ich dir was Schönes bei Topshop'),
                (15250, 'Ey, Ich schau dich an und du siehst top aus'),
                (20230, 'Baby schau mich an und zieh dein Top aus'),
                (23820, "Ey, mach's wie mit einem Lollipop"),
                (28040, 'Dann kauf ich dir was Schönes bei Topshop'),
                (30290, '♪'),
                (33130, '♪'),
                (38500, 'Ich steh für gar nichts und für gar nichts steh ich ein, ja'),
                (41800, 'Ich bin froh, treff ich damit den Nerv der Zeit, ja'),
                (45510, 'Dein Höschen wird zu einem Teich'),
                (49520, 'Bei meiner Gleichgültigkeit'),
                (52930, 'Ich steh für gar nichts, schau mich an, es steht mir gut'),
                (55890, 'Ich brauche meinen Kopf für die Tattoos'),
                (59480, 'Deine Augen Pepp Teller'),
                (63870, 'Dein Leben wie ein Pappbecher'),
                (67060, 'Ausgetrunken und besoffen'),
                (70500, 'Hab ich ihn einfach weggeworfen'),
                (74430, 'Ey, Ich schau dich an und du siehst top aus'),
                (77950, 'Baby schau mich an und zieh dein Top aus'),
                (82060, "Ey, mach's wie mit einem Lollipop"),
                (85890, 'Dann kauf ich dir was Schönes bei Topshop'),
                (90880, '♪'),
                (96180, 'Ich steh für gar nichts'),
                (97300, 'Doch nicht alleine da, ja'),
                (99790, 'Mein Nachbar benutzt Insta als Newsportal'),
                (103760, 'Und bis auf dein Spiegelbild'),
                (107340, "Is' auch dir alles ziemlich egal"),
                (110690, 'Ich steh für gar nichts'),
                (111890, 'Doch dafür stehst du auf mich'),
                (113830, 'Nieder mit den Alpen, Mittelmeer freie Sicht'),
                (117300, "Und in Dakar brenn' Fabriken nieder"),
                (121460, 'Woher kommen meine neuen Sneaker?'),
                (124790, 'Wenn ich trage was der Teufel trägt'),
                (128680, 'Wird das dann auch in der Hölle genäht?'),
                (132590, 'Können Kinderhände besser arbeiten?'),
                (135740, 'Bin ich so weil sich meine Eltern streiten?'),
                (139300, 'Hab ich Schiss nie einen Job zu kriegen?'),
                (142810, 'Hab ich Schiss mich in nen Mann zu verlieben?'),
                (146890, 'Ich fühl mich schwach und mir ist peinlich dass ich scheu bin'),
                (150110, 'Schlag ich deshalb meine Freundin?'),
                (154320, 'Doch all dies könnte mir nie schaden'),
                (158000, 'Denn all dies würde ich mich nie fragen'),
                (160930, 'Ey, ich schau dich an und du siehst top aus'),
                (165150, 'Baby, schau mich an und zieh dein Top aus'),
                (168400, "Ey, mach's wie mit einem Lollipop"),
                (171720, 'Dann kauf ich dir was Schönes bei Topshop'),
                (174720, '')]
main_chords_body = """

Capo: 1<br><br>[Chorus]<br><span class="chord_span">Em</span>                   <span class="chord_span">C</span>
<span class="chord_span">B</span><br>   Ey ich schau dich an und du siehst top aus<br><span class="chord_span">Em</span>
        <span class="chord_span">C</span>                <span class="chord_span">B</span><br>   Baby schau mich an und zieh dein Top aus<br><span class="chord_span">Em</span>        <span class="chord_span">C</span>             <span class="chord_span">B</span>       <span class="chord_span">Em</span><br>   Mach&#039;s wie mit einem Lollipop<br>                         <span class="chord_span">C</span>           <span class="chord_span">B</span><br>   Dann kauf ich dir was Sch&ouml;nes bei Topshop<br><br><span class="chord_span">Em</span>                    <span class="chord_span">C</span>                <span class="chord_span">B</span><br>   Ey, ich schau dich an und du siehst top aus<br><span class="chord_span">Em</span>                 <span class="chord_span">C</span>                <span class="chord_span">B</span><br>   Baby schau mich an und zieh dein Top aus<br><span class="chord_span">Em</span>               <span class="chord_span">C</span>             <span class="chord_span">B</span><br>   Eeecy, Mach&#039;s wie mit einem Lollipop<br><span class="chord_span">Em</span>                       <span class="chord_span">C</span>      
     <span class="chord_span">B</span><br>   Dann kauf ich dir was Sch&ouml;nes bei Topshop<br><br>[Instrumental]<br><span class="chord_span">Em</span>   <span class="chord_span">C</span>  <span class="chord_span">B</span>    x2<br><br>[Verse 1]<br><span class="chord_span">Em</span>                                 <span class="chord_span">C</span>                   <span class="chord_span">B</span><br>   Ich steh f&uuml;r gar nichts und f&uuml;r gar nichts steh ich ein, ja<br><span class="chord_span">Em</span> 
                         <span class="chord_span">C</span>                   <span class="chord_span">B</span><br>   Ich bin froh, treff&#039; ich damit den Nerv der Zeit, ja<br><span class="chord_span">Am</span>                    <span class="chord_span">C</span>           <span class="chord_span">B</span><br>   Dein H&ouml;schen wird zu einem Teich<br><br>   Bei meiner Gleichg&uuml;ltigkeit<br><br><span class="chord_span">Em</span>                                     <span class="chord_span">C</span>        
        <span class="chord_span">B</span><br>   Ich steh f&uuml;r gar nichts, schau mich an, es steht mir gut, uuh<br><span class="chord_span">Em</span>                    <span class="chord_span">C</span>            <span class="chord_span">B</span><br>   Ich brauche meinen Kopf f&uuml;r die Tattoos<br><br><span class="chord_span">Am</span>                        <br>   Deine Augen Pep Teller<br><span class="chord_span">C</span>                                 <br>   Dein Leben wie ein Pappbecher<br><span class="chord_span">F#</span><br>   Ausgetrunken und besoffen<br><span class="chord_span">B</span><br>   Hab ich ihn einfach weggeworfen<br><br>[Chorus]<br>   <span class="chord_span">Em</span>                   <span class="chord_span">C</span>                <span class="chord_span">B</span><br>   Eeyy, Ich schau dich an und du siehst top aus<br>N.C.
  <span class="chord_span">B</span><br>   Baby schau mich an und zieh dein Top aus<br><span class="chord_span">Em</span>
   <span class="chord_span">C</span>             <span class="chord_span">B</span>          <br>   Ey, mach&#039;s wie mit einem 
Lollipop<br><span class="chord_span">Em</span>                       <span class="chord_span">C</span>           <span class="chord_span">B</span><br>   Dann kauf ich dir was Sch&ouml;nes bei Topshop<br><br>[Instrumental]<br><span class="chord_span">Em</span>   <span class="chord_span">C</span>  <span class="chord_span">B</span>    x2<br><br>[Verse 2]<br><span class="chord_span">Em</span>                               <span class="chord_span">C</span>            <span class="chord_span">B</span><br>   Ich steh 
f&uuml;r gar nichts, doch nicht allein da, ja<br><span class="chord_span">Em</span>                      <span class="chord_span">C</span>       <span class="chord_span">B</span>        <span class="chord_span">Am</span>   <br>   Mein Nachbar benutzt Insta als Newsportal<br>                    <span class="chord_span">C</span>          <span class="chord_span">B</span><br>   Und bis auf dein Spiegelbild ist auch dir alles ziemlich egal<br><span class="chord_span">Em</span>                                <span class="chord_span">C</span>                 <span class="chord_span">B</span><br>   Ich steh f&uuml;r gar nichts doch daf&uuml;r stehst du auf mich, uh<br><span class="chord_span">Em</span>                        <span class="chord_span">C</span>          <span class="chord_span">B</span><br>   Nieder mit den Alpen - Mittelmeer freie Sicht<br><br>[Bridge]<br><span class="chord_span">Am</span><br>   Und in Dakar brenn&#039; Fabriken nieder<br><span class="chord_span">C</span><br>   Woher kommen meine neuen Sneaker?<br><span class="chord_span">D</span><br>   Wenn ich trage was der Teufel tr&auml;gt<br><span class="chord_span">B7</span><br> 
  Wird das dann auch in der H&ouml;lle gen&auml;ht?<br><span class="chord_span">C</span><br>   K&ouml;nnen Kinderh&auml;nde besser arbeiten?<br><span class="chord_span">Am</span><br>   Bin ich so weil sich meine Eltern streiten?<br><span class="chord_span">D</span><br>   Habe ich Schiss nie einen Job zu kriegen?<br><span class="chord_span">B7</span><br>   Hab ich Schiss mich in einen 
Mann zu verlieben?<br><span class="chord_span">C</span><br>   Ich f&uuml;hl&#039; mich schwach und mir ist peinlich, dass ich scheu bin<br><span class="chord_span">Am</span><br>   Schlag ich deshalb meine Freundin?<br><span class="chord_span">D</span><br>   
Doch all dies k&ouml;nnte mir nie schaden<br><span class="chord_span">B7</span><br>   Denn all dies w&uuml;rde ich mich nie fragen<br><br>[Chorus]<br>   <span class="chord_span">Em</span>                  <span class="chord_span">C</span>                <span class="chord_span">B</span><br>   Eey, Ich schau dich an und du siehst top aus<br><span class="chord_span">Em</span>
      <span class="chord_span">C</span>                <span class="chord_span">B</span><br>   Baby schau mich an und zieh dein Top aus<br><span class="chord_span">Em</span>            <span class="chord_span">C</span>             <span class="chord_span">B</span>         <br>   Ey, mach&#039;s wie mit einem Lollipop<br><span class="chord_span">Em</span>                        <span class="chord_span">C</span>           <span class="chord_span">B</span><br>    Dann kauf ich dir was Sch&ouml;nes bei Topshop<br><br>[Outro]<br><span class="chord_span">Em</span>   <span class="chord_span">C</span>  <span class="chord_span">B</span><br><span 
class="chord_span">Em</span>   <span class="chord_span">C</span>  <span class="chord_span">B</span><br>        Lalala<br><span class="chord_span">Em</span>   <span class="chord_span">C</span>  <span class="chord_span">B</span><br>Laa<br><span class="chord_span">Em</span>   <span class="chord_span">C</span>  <span class="chord_span">B</span><br>    Eey Lalala<br><span class="chord_span">Em</span>   <span class="chord_span">C</span>  <span class="chord_span">B</span><br>Laa     <br><span class="chord_span">Em</span>   <span class="chord_span">C</span>  <span class="chord_span">B</span><br>   Uuh  Lalala<br><span class="chord_span">Em</span>   <span class="chord_span">C</span>  <span class="chord_span">B</span><br>Laa Eeey  <br><span class="chord_span">Em</span>   <span class="chord_span">C</span>  <span class="chord_span">B</span> <span class="chord_span">Em</span>
"""
main_chords_body_line_array_lyrics_with_index_and_timestamp = [
            [0, 4, ' Ey ich schau dich an und du siehst top aus'],
            ['NOTSYNCED', 6, ' Baby schau mich an und zieh dein Top aus'],
            ['NOTSYNCED', 8, " Mach's wie mit einem Lollipop"],
            ['NOTSYNCED', 10, ' Dann kauf ich dir was Schönes bei Topshop'],
            [10, 13, ' Ey, ich schau dich an und du siehst top aus'],
            [12, 15, ' Baby schau mich an und zieh dein Top aus'],
            [14, 17, " Eeecy, Mach's wie mit einem Lollipop"],
            [16, 19, ' Dann kauf ich dir was Schönes bei Topshop'],
            [18, 26, ' Ich steh für gar nichts und für gar nichts steh ich ein, ja'],
            [20, 28, " Ich bin froh, treff' ich damit den Nerv der Zeit, ja"],
            [22, 30, ' Dein Höschen wird zu einem Teich'],
            [24, 32, ' Bei meiner Gleichgültigkeit'],
            [26, 35, ' Ich steh für gar nichts, schau mich an, es steht mir gut, uuh'],
            [28, 37, ' Ich brauche meinen Kopf für die Tattoos'],
            [30, 40, ' Deine Augen Pep Teller'],
            [32, 42, ' Dein Leben wie ein Pappbecher'],
            [34, 44, ' Ausgetrunken und besoffen'],
            [36, 46, ' Hab ich ihn einfach weggeworfen'],
            [38, 50, ' Eeyy, Ich schau dich an und du siehst top aus'],
            [40, 52, ' Baby schau mich an und zieh dein Top aus'],
            [42, 54, " Ey, mach's wie mit einem Lollipop"],
            [44, 56, ' Dann kauf ich dir was Schönes bei Topshop'],
            [46, 63, ' Ich steh für gar nichts, doch nicht allein da, ja'],
            [48, 65, ' Mein Nachbar benutzt Insta als Newsportal'],
            [50, 67, ' Und bis auf dein Spiegelbild ist auch dir alles ziemlich egal'],
            [52, 69, ' Ich steh für gar nichts doch dafür stehst du auf mich, uh'],
            [54, 71, ' Nieder mit den Alpen - Mittelmeer freie Sicht'],
            [56, 75, " Und in Dakar brenn' Fabriken nieder"],
            [58, 77, ' Woher kommen meine neuen Sneaker?'],
            [60, 79, ' Wenn ich trage was der Teufel trägt'],
            [62, 81, ' Wird das dann auch in der Hölle genäht?'],
            [64, 83, ' Können Kinderhände besser arbeiten?'],
            [66, 85, ' Bin ich so weil sich meine Eltern streiten?'],
            [68, 87, ' Habe ich Schiss nie einen Job zu kriegen?'],
            [70, 89, ' Hab ich Schiss mich in einen Mann zu verlieben?'],
            [72, 91, " Ich fühl' mich schwach und mir ist peinlich, dass ich scheu bin"],
            [74, 93, ' Schlag ich deshalb meine Freundin?'],
            [76, 95, ' Doch all dies könnte mir nie schaden'],
            [78, 97, ' Denn all dies würde ich mich nie fragen'],
            [80, 101, ' Eey, Ich schau dich an und du siehst top aus'],
            [82, 103, ' Baby schau mich an und zieh dein Top aus'],
            [84, 105, " Ey, mach's wie mit einem Lollipop"],
            [86, 107, ' Dann kauf ich dir was Schönes bei Topshop'],
            [88, 112, ' Lalala'],
            ['NOTSYNCED', 114, 'Laa'],
            ['NOTSYNCED', 116, ' Eey Lalala'],
            ['NOTSYNCED', 118, 'Laa '],
            ['NOTSYNCED', 120, ' Uuh Lalala'],
            [98, 122, 'Laa Eeey ']
            ]

track_length_ms = 98

def insertTimestampsToMainChordsBody(synced_lyrics_tupel_array, main_chords_body, track_length_ms):
    main_chords_body_line_array = main_chords_body.split("<br>")
    main_chords_body_line_array_lyrics = [line for line in main_chords_body_line_array if not (line == "" or "chord_span" in line or "[" in line or "]" in line or "|-" in line or "-|" in line or "capo" in line.lower())]
    main_chords_body_line_array_lyrics_with_index = [
        [index, line] for index, line in enumerate(main_chords_body_line_array)
        if not (line == "" or "chord_span" in line or "[" in line or "]" in line or "|-" in line or "-|" in line or "capo" in line.lower())
    ]
    
    # NOTSYNCED, INDEX, LYRICSLINE
    main_chords_body_line_array_lyrics_with_index_and_timestamp = [["NOTSYNCED", t[0], t[1]] for t in main_chords_body_line_array_lyrics_with_index]
    print(main_chords_body_line_array_lyrics_with_index_and_timestamp)

# replace NOTSCYNCED timestamps with interpolated timestamps IF before and after are timestamps (doesn't apply if first or last lines is NOTSYNCED)
def lerpNOTSYNCEDWithin(main_chords_body_line_array_lyrics_with_index_and_timestamp):
    for checkNOTSYNCED in range (0, len(main_chords_body_line_array_lyrics_with_index_and_timestamp)):
        ic(checkNOTSYNCED)
        amm_of_cons_notsynced_lines = 0
        timestamp_adder = 0
        sorroundingTimestampAfter = 0
        sorroundingTimestampBefore = 0
        if main_chords_body_line_array_lyrics_with_index_and_timestamp[checkNOTSYNCED][0] == "NOTSYNCED":
            ic(main_chords_body_line_array_lyrics_with_index_and_timestamp[checkNOTSYNCED])
            
            if (checkNOTSYNCED == 0):
                ic("first line is NOTSYNCED")
                continue
            
            if (main_chords_body_line_array_lyrics_with_index_and_timestamp[checkNOTSYNCED-1][0] == "NOTSYNCED"):
                ic("Line before is also NOTSYNCED")
                continue
            
            sorroundingTimestampBefore = int(str((main_chords_body_line_array_lyrics_with_index_and_timestamp[checkNOTSYNCED-1][0])).replace("\" class='ONE_LINE_OFF_IS_TWO_UNOFF'", "").replace("\" class='TWO_LINE_OFF_IS_ONE_UNOFF'", "").replace("\" class='LERP_LINE'", ""))
            
            for checkFirstNumberAgain in range (checkNOTSYNCED, len(main_chords_body_line_array_lyrics_with_index_and_timestamp)):
                ic(main_chords_body_line_array_lyrics_with_index_and_timestamp[checkFirstNumberAgain])
                # amm_of_cons_notsynced_lines is by one line NOTSYNCED consecutive also 2 already
                amm_of_cons_notsynced_lines += 1
                
                # ignore if NOTSYNCED goes to the end of the array
                if main_chords_body_line_array_lyrics_with_index_and_timestamp[checkFirstNumberAgain][0] == "NOTSYNCED" and checkFirstNumberAgain == len(main_chords_body_line_array_lyrics_with_index_and_timestamp)-1:
                    amm_of_cons_notsynced_lines = 0
                    break
                
                # found the first timestamp that is not NOTSYNCED
                if main_chords_body_line_array_lyrics_with_index_and_timestamp[checkFirstNumberAgain][0] != "NOTSYNCED":
                    sorroundingTimestampAfter = int(str(main_chords_body_line_array_lyrics_with_index_and_timestamp[checkFirstNumberAgain][0]).replace("\" class='ONE_LINE_OFF_IS_TWO_UNOFF'", "").replace("\" class='TWO_LINE_OFF_IS_ONE_UNOFF'", "").replace("\" class='LERP_LINE'", ""))
                    break
            
            # ignore if NOTSYNCED goes to the end of the array
            if amm_of_cons_notsynced_lines == 0:
                break
            
            timestamp_adder = (sorroundingTimestampAfter - sorroundingTimestampBefore) / (amm_of_cons_notsynced_lines)
            for addTimestamp in range (1, amm_of_cons_notsynced_lines):
                main_chords_body_line_array_lyrics_with_index_and_timestamp[checkNOTSYNCED + addTimestamp-1][0] = str(int(sorroundingTimestampBefore + (timestamp_adder * addTimestamp))) + "\" class='LERP_LINE'"
     
    ic(main_chords_body_line_array_lyrics_with_index_and_timestamp)       

def lerpNOTSYNCEDLastLines(main_chords_body_line_array_lyrics_with_index_and_timestamp, track_length_ms):
    amm_of_cons_notsynced_lines = 0
    
    # if last line is NOTSYNCED
    if main_chords_body_line_array_lyrics_with_index_and_timestamp[len(main_chords_body_line_array_lyrics_with_index_and_timestamp)-1][0] == "NOTSYNCED":
        # insert track length as timestamp into last line
        main_chords_body_line_array_lyrics_with_index_and_timestamp[len(main_chords_body_line_array_lyrics_with_index_and_timestamp)-1][0] = str(track_length_ms) + "\" class='LERP_LINE'"
        timestamp_before_index = 0
        # iterate backwards until first not NOTSYNCED
        for i in range(len(main_chords_body_line_array_lyrics_with_index_and_timestamp)-2, -1, -1):
            amm_of_cons_notsynced_lines += 1
            if main_chords_body_line_array_lyrics_with_index_and_timestamp[i][0] != "NOTSYNCED":
                timestamp_before_index = i
                break
        
        sorroundingTimestampAfter = track_length_ms
        sorroundingTimestampBefore = int(str((main_chords_body_line_array_lyrics_with_index_and_timestamp[timestamp_before_index][0])).replace("\" class='ONE_LINE_OFF_IS_TWO_UNOFF'", "").replace("\" class='TWO_LINE_OFF_IS_ONE_UNOFF'", "").replace("\" class='LERP_LINE'", ""))
        
        timestamp_adder = (sorroundingTimestampAfter - sorroundingTimestampBefore) / (amm_of_cons_notsynced_lines)
        for addTimestamp in range (1, amm_of_cons_notsynced_lines):
            main_chords_body_line_array_lyrics_with_index_and_timestamp[timestamp_before_index+1 + addTimestamp-1][0] = str(int(sorroundingTimestampBefore + (timestamp_adder * addTimestamp))) + "\" class='LERP_LINE'"
                    
                    
def lerpNOTSYNCEDFirstLines(main_chords_body_line_array_lyrics_with_index_and_timestamp):
    amm_of_cons_notsynced_lines = 0
    sorroundingTimestampBefore = 0
    
    if main_chords_body_line_array_lyrics_with_index_and_timestamp[0][0] == "NOTSYNCED":
        # insert 0 ms as timestamp into first line
        main_chords_body_line_array_lyrics_with_index_and_timestamp[0][0] = "0" + "\" class='LERP_LINE'"
        
        # iterate until first not NOTSYNCED   
        for i in range(1, len(main_chords_body_line_array_lyrics_with_index_and_timestamp)):    
            amm_of_cons_notsynced_lines += 1
            if main_chords_body_line_array_lyrics_with_index_and_timestamp[i][0] != "NOTSYNCED":  
                sorroundingTimestampAfter = int(str((main_chords_body_line_array_lyrics_with_index_and_timestamp[i][0])).replace("\" class='ONE_LINE_OFF_IS_TWO_UNOFF'", "").replace("\" class='TWO_LINE_OFF_IS_ONE_UNOFF'", "").replace("\" class='LERP_LINE'", ""))
                break
        
        timestamp_adder = (sorroundingTimestampAfter - sorroundingTimestampBefore) / (amm_of_cons_notsynced_lines)
        for addTimestamp in range (1, amm_of_cons_notsynced_lines):
            main_chords_body_line_array_lyrics_with_index_and_timestamp[1 + addTimestamp-1][0] = str(int(sorroundingTimestampBefore + (timestamp_adder * addTimestamp))) + "\" class='LERP_LINE'"
    
    ic(main_chords_body_line_array_lyrics_with_index_and_timestamp)   
     
def main():
    lerpNOTSYNCEDWithin(main_chords_body_line_array_lyrics_with_index_and_timestamp)

if __name__ == '__main__':
    main()